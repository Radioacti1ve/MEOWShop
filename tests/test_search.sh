#!/bin/bash
set -e

API_URL="http://localhost:8000/catalog"

echo "1. Тестирование базового поиска..."
echo "Поиск товаров со словом 'смартфон':"
curl -s "$API_URL/search?q=%D1%81%D0%BC%D0%B0%D1%80%D1%82%D0%BE%D0%BD" | jq '.'
echo -e "\n----------------------------\n"

echo "2. Тестирование поиска с пагинацией..."
echo "Поиск с ограничением 3 товаров на странице:"
curl -s "$API_URL/search?q=%D1%82%D0%B5%D1%85%D0%BD%D0%B8%D0%BA%D0%B0&page=1&page_size=3" | jq '.'
echo -e "\n----------------------------\n"

echo "3. Тестирование поиска по категории..."
echo "Поиск в категории 'Электроника':"
curl -s "$API_URL/search?q=%D1%87%D0%B0%D1%81%D1%8B&category_id=%D0%AD%D0%BB%D0%B5%D0%BA%D1%82%D1%80%D0%BE%D0%BD%D0%B8%D0%BA%D0%B0" | jq '.'
echo -e "\n----------------------------\n"

echo "4. Тестирование автодополнения..."
echo "Получение подсказок для 'на':"
curl -s "$API_URL/suggest?q=%D0%BD%D0%B0&limit=5" | jq '.'
echo -e "\n----------------------------\n"

echo "5. Тестирование похожих товаров..."
echo "Поиск похожих товаров для Xiaomi Redmi Note 11 (ID=1):"
curl -s "$API_URL/similar/1?limit=5" | jq '.'
echo -e "\n----------------------------\n"

echo "6. Тестирование поиска с несуществующим текстом..."
echo "Поиск несуществующего товара:"
curl -s "$API_URL/search?q=abcdefghijklmnopqrstuvwxyz123456789" | jq '.'
echo -e "\n----------------------------\n"

echo "7. Тестирование автодополнения с коротким запросом..."
echo "Получение подсказок для 'п':"
curl -s "$API_URL/suggest?q=%D0%BF&limit=10" | jq '.'
echo -e "\n----------------------------\n"

echo "8. Тестирование поиска с спец. символами..."
echo "Поиск с специальными символами:"
curl -s "$API_URL/search?q=%21%40%23%24%25%5E%26*" | jq '.'
echo -e "\n----------------------------\n"

echo "9. Тестирование похожих товаров с несуществующим ID..."
echo "Поиск похожих товаров для несуществующего ID:"
curl -s "$API_URL/similar/999999?limit=5" | jq '.'
echo -e "\n----------------------------\n"

echo "10. Тестирование поиска с сортировкой по релевантности..."
echo "Поиск наушников с сортировкой по релевантности:"
curl -s "$API_URL/search?q=%D0%BD%D0%B0%D1%83%D1%88%D0%BD%D0%B8%D0%BA%D0%B8&page=1&page_size=10" | jq '.'
echo -e "\n----------------------------\n"

# Добавим тесты на проверку ошибок
echo "11. Тестирование некорректных параметров пагинации..."
echo "Попытка использовать отрицательную страницу:"
curl -s "$API_URL/search?q=%D1%81%D0%BC%D0%B0%D1%80%D1%82%D1%84%D0%BE%D0%BD&page=-1" | jq '.'
echo -e "\n----------------------------\n"

echo "12. Тестирование слишком большого размера страницы..."
echo "Попытка запросить слишком много результатов:"
curl -s "$API_URL/search?q=%D1%81%D0%BC%D0%B0%D1%80%D1%82%D1%84%D0%BE%D0%BD&page_size=1000" | jq '.'
echo -e "\n----------------------------\n"

echo "13. Тестирование поиска без параметра q..."
echo "Попытка поиска без поискового запроса:"
curl -s "$API_URL/search" | jq '.'
echo -e "\n----------------------------\n"

echo "Тестирование поиска завершено."
