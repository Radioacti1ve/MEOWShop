#!/bin/bash

# –¶–≤–µ—Ç–æ–≤—ã–µ –∫–æ–¥—ã –¥–ª—è –≤—ã–≤–æ–¥–∞
GREEN='\033[0;32m'
RED='\033[0;31m'
NC='\033[0m' # No Color
YELLOW='\033[1;33m'

# –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å —Ç–µ—Å—Ç–∞–º–∏
TEST_DIR="$(dirname "$0")"
cd "$TEST_DIR"

# –°—á–µ—Ç—á–∏–∫–∏ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
TOTAL=0
PASSED=0
FAILED=0

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–∞
run_test() {
    local test_file="$1"
    local test_name="$(basename "$test_file")"
    
    echo -e "\n${YELLOW}=== –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞: $test_name ===${NC}"
    if bash "$test_file"; then
        echo -e "${GREEN}‚úÖ –¢–µ—Å—Ç $test_name –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ${NC}"
        PASSED=$((PASSED + 1))
        return 0
    else
        echo -e "${RED}‚ùå –¢–µ—Å—Ç $test_name –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π${NC}"
        FAILED=$((FAILED + 1))
        return 1
    fi
}

# –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —Ç–µ—Å—Ç—ã —Å —Ü–∏—Ñ—Ä–∞–º–∏ –≤ –Ω–∞—á–∞–ª–µ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º –∏—Ö
TESTS=$(find . -maxdepth 1 -type f -name '[0-9]*.test_*.sh' | sort)

# –ó–∞–ø—É—Å–∫–∞–µ–º –∫–∞–∂–¥—ã–π —Ç–µ—Å—Ç
for test in $TESTS; do
    TOTAL=$((TOTAL + 1))
    run_test "$test"
done

# –í—ã–≤–æ–¥–∏–º –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
echo -e "\n${YELLOW}=== –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ===${NC}"
echo -e "–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: ${TOTAL}"
echo -e "${GREEN}–£—Å–ø–µ—à–Ω–æ: ${PASSED}${NC}"
echo -e "${RED}–ù–µ—É–¥–∞—á–Ω–æ: ${FAILED}${NC}"

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
if [ $FAILED -eq 0 ]; then
    echo -e "\n${GREEN}üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!${NC}"
    exit 0
else
    echo -e "\n${RED}‚ùå –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å —Å –æ—à–∏–±–∫–æ–π${NC}"
    exit 1
fi
